---
description: 键集游标
title: 键集游标 |Microsoft Docs
ms.prod: sql
ms.prod_service: connectivity
ms.technology: ado
ms.custom: ''
ms.date: 01/19/2017
ms.reviewer: ''
ms.topic: conceptual
helpviewer_keywords:
- Keyset cursors [ADO]
- cursors [ADO], Keyset
ms.assetid: 14b51b17-6fd9-4146-af45-ca4b0fe6d48a
author: rothja
ms.author: jroth
ms.openlocfilehash: 4071772212226b2b09886476c6577cac73cd3f79
ms.sourcegitcommit: 917df4ffd22e4a229af7dc481dcce3ebba0aa4d7
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/10/2021
ms.locfileid: "100037267"
---
# <a name="keyset-cursors"></a>键集游标
键集游标在静态游标和动态游标的功能检测更改时提供其功能。 比如静态游标，它不会始终检测对结果集的成员身份和顺序的更改。 比如动态游标，它会检测对结果集中的行值的更改。  
  
 由键集驱动的游标由一组唯一标识符（键）控制，这组键称为键集。 键是根据以唯一方式标识结果集中各行的一组列生成的。 键集是查询语句返回的所有行中的一组键值。  
  
 使用由键集驱动的游标，为游标中的每行生成和保存一个键，并将其存储在客户端工作站或服务器上。 访问每行时，存储的密钥可用来从数据源提取当前数据值。 在由键集驱动的游标中，如果键集完全填充，将冻结结果集成员身份。 此后，在重新打开结果集前，都不会执行影响成员身份的添加或更新操作。  
  
 对数据值所做的更改 (由键集所有者或其他进程进行) 在用户滚动结果集时可见。 游标外所做的插入（由其他进程执行）仅在关闭并重新打开游标后可见。 游标内部所做的插入在结果集的末尾可见。  
  
 当由键集驱动的游标尝试检索已删除的行时，该行将在结果集中显示为 "洞"。 行键存在于键集中，但行不再存在于结果集中。 如果更新了行中的键值，则会将该行视为已被删除然后插入，因此此类行还会在结果集中显示为洞。 尽管由键集驱动的游标始终可以检测由其他进程删除的行，但可以选择删除它自身删除的行的键。 执行此操作的由键集驱动的游标无法检测自己的删除，因为已删除该证据。  
  
 键列的更新操作类似于删除旧密钥，然后插入新密钥。 如果未通过游标进行更新，则新的密钥值将不可见。 如果通过游标进行更新，新的键值将显示在结果集的末尾。  
  
 由键集驱动的游标（称为键集驱动的标准游标）存在变体。 在由键集驱动的标准游标中，结果集中的行成员身份和行顺序在游标打开时是固定的，但是对游标所有者做出的值的更改和其他进程所做的提交更改是可见的。 如果更改了将使的行或影响行的顺序，则在关闭并重新打开游标之前，该行不会消失或移动。 插入的数据不显示，但在提取行时将显示对现有数据所做的更改。  
  
 由键集驱动的游标难以正确使用，因为对数据更改的敏感度取决于许多不同的情况，如上所述。 但是，如果你的应用程序不关心并发更新，可以通过编程方式处理错误的键，并且必须直接访问某些键控行，由键集驱动的游标可能适用。 使用 **AdOpenKeyset CursorTypeEnum** 指示要在 ADO 中使用键集游标。  
  
## <a name="see-also"></a>另请参阅  
 [只进游标](./forward-only-cursors.md)   
 [静态游标](./static-cursors.md)   
 [动态游标](./dynamic-cursors.md)