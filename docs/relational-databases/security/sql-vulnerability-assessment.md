---
title: SQL 漏洞评估 | Microsoft Docs
description: 使用 SQL 漏洞评估工具来帮助发现、跟踪和修正 SQL Server 中潜在的数据库漏洞。
ms.custom: ''
ms.date: 11/30/2017
ms.prod: sql
ms.prod_service: security, sql-database
ms.reviewer: ''
ms.technology: security
ms.topic: conceptual
helpviewer_keywords:
- SQL Vulnerability Assessment
author: yualan
ms.author: alayu
monikerRange: =azuresqldb-current||>=sql-server-2016||>=sql-server-linux-2017||=azuresqldb-mi-current
ms.openlocfilehash: 322501044a3f7766c81f5deee7b11c193c89e918
ms.sourcegitcommit: 917df4ffd22e4a229af7dc481dcce3ebba0aa4d7
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/10/2021
ms.locfileid: "100340116"
---
# <a name="sql-vulnerability-assessment"></a>SQL 漏洞评估

[!INCLUDE [SQL Server Azure SQL Database](../../includes/applies-to-version/sql-asdb.md)]

SQL 漏洞评估是一款易于使用的工具，有助于发现、跟踪和修正可能存在的数据库漏洞。 可以使用此工具积极提升数据库安全性。

漏洞评估不仅受 SQL Server 2012 及更高版本支持，还可以在 [Azure SQL 数据库](/azure/sql-database/sql-vulnerability-assessment)上运行。

## <a name="vulnerability-assessment-features"></a>漏洞评估功能
SQL 漏洞评估 (VA) 服务可便于用户随时了解安全状态，并提供可操作步骤，指导用户如何解决安全问题，并提升数据库安全性。 此工具有助于：
- 满足必须生成数据库扫描报告的符合性要求。 
- 满足数据隐私标准。
- 监视变化难以跟踪的动态数据库环境。

VA 服务直接对数据库运行扫描。 此服务采用规则知识库，可标记安全漏洞，并突出显示不符合最佳做法的情况（如配置错误、权限过多和敏感数据不受保护）。 这些规则以 Microsoft 推荐的最佳做法为依据，重点关注对数据库及其宝贵数据构成最大风险的安全问题。 这些规则还体现了各个监管机构提出的许多要求，旨在满足它们的符合性标准。

扫描结果包括旨在解决每个问题的可操作步骤，并提供自定义修正脚本（若适用）。 可为环境自定义评估报告，具体方法是设置权限配置、功能配置和数据库设置的可接受基线。 

## <a name="prerequisites"></a>先决条件
此功能仅适用于 SQL Server Management Studio (SSMS) v17.4 或更高版本。 请确保使用最新版本。 可以从[此处](../../ssms/download-sql-server-management-studio-ssms.md)获取最新版本。

## <a name="getting-started"></a>入门
若要开始对数据库运行漏洞评估，请按照以下步骤操作：
   1.   打开 SQL Server Management Studio。

   2.   连接 SQL Server 数据库引擎实例或 localhost。

   3.   展开“数据库”，右键单击一个数据库，指向“任务”，选择“漏洞评估”，再单击“扫描漏洞...”   

   4.   可以扫描系统数据库之一，通过运行扫描来检查是否有服务器级问题。 展开“系统数据库”，右键单击“master”数据库，指向“任务”，选择“漏洞评估”，再单击“扫描漏洞...”    

   ![入门](media/sql-vulnerability-assessment/1-SSMSGetStarted.png)

## <a name="tutorial"></a>教程
若要对数据库运行和管理漏洞评估，请按照以下步骤操作。

### <a name="1-run-a-scan"></a>1.运行扫描

在“扫描漏洞”对话框中，可以指定扫描结果的保存位置。 可以保留默认位置，或单击“浏览...”将扫描结果保存到其他位置。

准备好扫描后，单击“确定”扫描数据库，检查是否有漏洞。

  > [!NOTE]   
  > 扫描是轻型的安全功能。 只需几秒即可运行，且为完全只读。 此功能不会对数据库做出任何更改。

![保存扫描文件](media/sql-vulnerability-assessment/2-ssmssavescanfile.png)

### <a name="2-view-the-report"></a>2.查看报告

扫描完成后，扫描报告会自动显示在主 SSMS 窗格中。 报告概述了安全状态、发现的问题数及其各自的严重性。 结果包括未遵循最佳做法的警告，以及安全相关设置（如数据库主体和角色及其相关权限）的快照。 扫描报告还映射了在数据库中发现的敏感数据，并建议了可用于保护这些数据的内置方法。

![扫描结果](media/sql-vulnerability-assessment/3-ssmsscanresults.png)

### <a name="3-analyze-the-results-and-resolve-issues"></a>3.分析结果并解决问题

查看结果并确定报告中发现的哪些问题是环境中真正存在的安全问题。 深入研究每个检查未通过的扫描结果，了解所发现问题的影响，以及每个安全检查未通过的原因。 使用报告提供的可操作修正信息来解决问题。

![结果详细信息](media/sql-vulnerability-assessment/4-ssmsresultdetails.png)

### <a name="4-set-your-baseline"></a>4.设置基线

在查看评估结果时，可将特定结果标记为环境中可接受的基线。 基线其实就是自定义结果的报告方式。 与基线匹配的结果被视为通过后续扫描。 

建立基线安全状态后，VA 就只会报告偏离基线的问题，这样便可以重点关注相关问题。

![设置基线](media/sql-vulnerability-assessment/5-ssmssetbaseline.png)

### <a name="5-run-a-new-scan-to-see-your-customized-tracking-report"></a>5.运行新扫描以查看自定义跟踪报告

完成规则基线设置后，运行新的扫描以查看自定义报告。 VA 现在只报告偏离获准的基线状态的安全问题。

![通过（根据基线）](media/sql-vulnerability-assessment/6-ssmspassperbaseline.png)

### <a name="6-open-a-previously-run-scan"></a>6.打开之前运行的扫描

可以随时打开现有扫描，查看之前运行的漏洞评估的结果。 为此，请右键单击数据库，指向“任务”，选择“漏洞评估”，再单击“打开现有扫描...”  选择要查看的扫描结果文件，再单击“打开”。 

也可以通过“文件”->“打开”菜单，打开现有扫描结果。 选择“漏洞评估……”，再打开“扫描”目录，查找要查看的扫描结果 。

![打开现有扫描](media/sql-vulnerability-assessment/7-ssmsopenexistingscan.png)

至此，可以使用 VA 监视数据库的安全性是否一直很高，并且是否符合组织策略。 如果要求必须有符合性报告，VA 报告有助于推动执行符合性流程。

## <a name="manage-vulnerability-assessments-using-powershell"></a>使用 PowerShell 管理漏洞评估
可使用 PowerShell cmdlet 以编程方式管理 SQL Server 的漏洞评估。 可使用 cmdlet 以编程方式运行评估，导出结果和管理基线。
若要开始使用，请从 PowerShell 库网站下载最新的 [SqlServer PowerShell 模块](https://www.powershellgallery.com/packages/SqlServer/)。 可在[此处](/archive/blogs/sqlsecurity/powershell-cmdlets-for-managing-sql-vulnerability-assessments)了解详细信息。

## <a name="next-steps"></a>后续步骤
若要详细了解 SQL 漏洞评估，请参阅以下资源：
- [对 Azure SQL 数据库运行漏洞评估](/azure/sql-database/sql-vulnerability-assessment) 
- [演示如何使用漏洞评估的 Channel 9 视频](https://channel9.msdn.com/Shows/Data-Exposed/Track-and-remediate-potential-database-vulnerabilities-with-SQL-Vulnerability-Assessment)


